---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BitCard from '../../components/BitCard.astro';
import { render } from 'astro:content';
import { getPublished } from '../../lib/content';

const bits = await getPublished('bits', {
  orderBy: (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
});

const rendered = await Promise.all(
  bits.map(async (bit) => {
    const { Content } = await render(bit);
    return { bit, Content };
  })
);
---

<BaseLayout title="生活小记">
  <div class="page-header">
    <h1 class="page-title">生活小记</h1>
    <span class="page-subtitle">生活不需要长篇，记得就好。</span>
  </div>

  <div class="bits-toolbar">
    <div class="bits-controls">
      <input id="bits-search" type="search" placeholder="搜索小记..." autocomplete="off" />
      <button id="bits-search-btn" type="button">搜索</button>
      <button class="new" id="bits-new-btn" type="button" data-new-bit>✍ 写小记</button>
    </div>
    <div class="bits-status" id="bits-search-status" role="status" aria-live="polite"></div>
  </div>

  <div id="bits-list">
    {rendered.map(({ bit, Content }) => (
      <BitCard bit={bit} Content={Content} />
    ))}
  </div>

  <script>
    import '../../scripts/bits-search.ts';
  </script>
</BaseLayout>
